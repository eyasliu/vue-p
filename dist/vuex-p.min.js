(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("vuex")):"function"==typeof define&&define.amd?define(["vuex"],b):(a=a||self,a["vuex-p"]=b(a.vuex))})(this,function(a){'use strict';function b(b){if(b.strict=!1,b._vm&&b._modules)return b;const c=new a.Store(b);return c}function c(a,b,c){const d=(b,e)=>{Object.keys(e._children).forEach(f=>{const g=e._children[f],h=new l(b.$path+"."+f,c,a);if(b[f])throw new Error("module key has duplicate key ["+f+"]");Object.defineProperty(b,f,{enumerable:!0,get(){return h},set(){throw new Error("[vuexp] cannot set module state")}}),d(h,g)})};d(a,b);const e=(a,b)=>{Object.keys(b.state).forEach(c=>{a[c]instanceof l?e(a[c],b._children[c]):Object.defineProperty(a,c,{enumerable:!0,get(){return a.$state[c]},set(b){return a.$store._withCommit(()=>{a.$state[c]=b}),a.$store._subscribers.forEach(function(c){return c({type:"VUEXP_CHANGE_STATE",payload:b},a.$state)}),a.$state[c]}})})};e(a,b),Object.keys(c.getters).forEach(b=>{const d=b.split("/"),e=d.length-1;d.reduce((a,d,f)=>f<e?a[d]:void(f==e&&"undefined"==typeof a[d]&&Object.defineProperty(a,d,{enumerable:!0,get(){return c.getters[b]},set(){throw new Error("getters can not set value")}})),a.$root)});const f=(a,b)=>{Object.keys(b._rawModule.actions||{}).forEach(c=>{if(a[c])throw new Error("action has duplicate key ["+c+"]");else a[c]=function(...d){return b._rawModule.actions[c].call(a,...d)}}),Object.keys(b._children).forEach(c=>{f(a[c],b._children[c])})};f(a,b);const g=(a,b)=>{Object.keys(b._rawModule.mutations||{}).forEach(c=>{if(a[c])throw new Error("mutation has duplicate key ["+c+"]");else a[c]=function(...d){return b._rawModule.mutations[c].call(a,...d)}}),Object.keys(b._children).forEach(c=>{g(a[c],b._children[c])})};g(a,b)}function d(a){const b=new l("root",a);return c(b,a._modules.root,a),b}function e(a){const c=a.$options;c.store&&(c.store=b(c.store),a.$store=c.store,a.$s=d(a.$store)),c.parent&&c.parent.$s&&(a.$s=c.parent.$s)}function f(a){a.$options.$computed&&(a.$options.computed=g(a,a.$options.$computed).reduce((a,{key:b,getter:c,setter:d})=>{if(a[b])throw new Error("computed has duplicate key ["+b+"]");return a[b]=d?{get:c,set:d}:c,a},a.$options.computed||{}))}function g(a,b){if(!b)return[];Array.isArray(b)&&(b=b.reduce((a,b)=>{let c;switch(typeof b){case"string":c=b.replace(/\//g,".").split(".").pop(),a[c]=b;break;case"function":if(c=b.name,!c)throw new Error("computed required function name");a[c]=b;break;case"object":Object.assign(a,b);}return a},{}));let c=[];return Object.keys(b).forEach(d=>{let e=b[d];switch(typeof e){case"string":e=e.replace(/\//g,"."),c.push({key:d,getter:()=>j(a.$s,e),setter:b=>k(a.$s,e,b)}),"news"==d&&console.log(a.$s,e,d,j(a.$s,e));break;case"function":c.push({key:d,getter:e.bind(a,a.$s)});break;case"object":e&&e.get&&c.push({key:d,getter:e.get.bind(a,a.$s),setter:e.set?b=>e.set.call(a,b,a.$s):null});break;default:c.push({key:d,getter:()=>e});}}),c}function h(a){a.$options.$methods&&(a.$options.methods=i(a,a.$options.$methods).reduce((a,{key:b,func:c})=>{if(a[b])throw new Error("methods has duplicate key ["+b+"]");return a[b]=c,a},a.$options.methods||{}))}function i(a,b){if(!b)return[];Array.isArray(b)&&(b=b.reduce((a,b)=>{let c;switch(typeof b){case"string":c=b.replace(/\//g,".").split(".").pop(),a[c]=b;break;case"function":if(c=b.name,!c)throw new Error("method required function name");a[c]=b;break;case"object":Object.assign(a,b);}return a},{}));let c=[];return Object.keys(b).forEach(d=>{let e=b[d];switch(typeof e){case"string":e=e.replace(/\//g,"."),c.push({key:d,func:(...b)=>j(a.$s,e).call(a,...b)});break;case"function":c.push({key:d,func:e.bind(a)});break;default:c.push({key:d,getter:()=>e});}}),c}a=a&&a.hasOwnProperty("default")?a["default"]:a;const j=(a,b,c,d)=>{if("undefined"==typeof b)return c;for(d=0,b=b.split?b.split("."):b;a&&d<b.length;)a=a[b[d++]];return a===void 0||d<b.length?c:a},k=(a,b,c)=>{if("undefined"==typeof b)throw new Error("required set key");let d=0;b=b.split?b.split("."):b;const e=b.pop();for(;a&&d<b.length;)a=a[b[d++]];if(a!==void 0&&d>=b.length&&a[e])return a[e]=c};class l{constructor(a,b,c){this.$path=a,this.$store=b,this.$root=c?c:this}get $state(){return this.$path.split(".").reduce((a,b)=>"root"===b?a:a[b],this.$store.state)}$registerModule(a,b){this.$store.registerModule(a,b);const d=this.$path+"."+a,e=d.split(".").reduce((a,b)=>{if(a){const c=a[b]||a._children[b];return c?c:void 0}},this.$store._modules);this[a]=new l(this.$path+"."+a,this.$store,this.$root),c(this[a],e,this.$store)}$unregisterModule(a){this.$store.unregisterModule(a),delete this[a]}}var m=b=>{b.use(a),b.mixin({beforeCreate:function(){const a=this;e(a),f(a),h(a)}})};return{install:m}});