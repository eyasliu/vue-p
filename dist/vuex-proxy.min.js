(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("vuex"),require("vue")):"function"==typeof define&&define.amd?define(["exports","vuex","vue"],b):(a=a||self,b(a.VuexProxy={},a.Vuex,a.Vue))})(this,function(a,b,c){'use strict';function d(a){if(a.strict=!1,a._vm&&a._modules)return a;const c=new b.Store(a);return c}function e(a,b,c){const d=(b,e)=>{Object.keys(e._children).forEach(f=>{const g=e._children[f],h=new m(b.$path+"."+f,c,a);if(b[f])throw new Error("module key has duplicate key ["+f+"]");Object.defineProperty(b,f,{enumerable:!0,get(){return h},set(){throw new Error("[vuexp] cannot set module state")}}),d(h,g)})};d(a,b);const e=(a,b)=>{Object.keys(b.state).forEach(c=>{a[c]instanceof m?e(a[c],b._children[c]):Object.defineProperty(a,c,{enumerable:!0,get(){return a.$state[c]},set(b){return a.$store._withCommit(()=>{a.$state[c]=b}),a.$store._subscribers.forEach(function(c){return c({type:"VUEXP_CHANGE_STATE",payload:b},a.$state)}),a.$state[c]}})})};e(a,b),Object.keys(c.getters).forEach(b=>{const d=b.split("/"),e=d.length-1;d.reduce((a,d,f)=>f<e?a[d]:void(f==e&&"undefined"==typeof a[d]&&Object.defineProperty(a,d,{enumerable:!0,get(){return c.getters[b]},set(){throw new Error("getters can not set value")}})),a.$root)});const f=(a,b)=>{Object.keys(b._rawModule.actions||{}).forEach(c=>{if(a[c])throw new Error("action has duplicate key ["+c+"]");else a[c]=function(...d){return b._rawModule.actions[c].call(a,...d)}}),Object.keys(b._children).forEach(c=>{f(a[c],b._children[c])})};f(a,b);const g=(a,b)=>{Object.keys(b._rawModule.mutations||{}).forEach(c=>{if(a[c])throw new Error("mutation has duplicate key ["+c+"]");else a[c]=function(...d){return b._rawModule.mutations[c].call(a,...d)}}),Object.keys(b._children).forEach(c=>{g(a[c],b._children[c])})};g(a,b);const h=(a,b)=>{Object.keys(b.watch||b._rawModule&&b._rawModule.watch||{}).forEach(c=>{setTimeout(()=>{a.$_watchVM.$watch(a.$path.replace("root","$s")+"."+c,(d,e)=>{let f=b._rawModule.watch[c];if("function"==typeof f)f.call(a,d,e);else if("string"==typeof f){if(f=a[f],!f)throw new Error("actions or mutations not found "+f);if("function"==typeof f)f.call(a,d,e);else throw new Error("watch handler must be function or action string name")}else throw new Error("watch handler must be function or action string name")})},1)}),Object.keys(b._rawModule&&b._rawModule.modules||{}).forEach(c=>{h(a[c],b._rawModule.modules[c])})};h(a,b)}function f(a){const b=new m("root",a);return e(b,a._modules.root,a),b}function g(a){if(a instanceof m)return a;let b=d(a),c=f(b);return c}function h(a){const b=a.$options;b.store&&(b.store=g(b.store),a.$s=b.store,a.$s.$watchVM=a,a.$store=a.$s.$store),b.parent&&b.parent.$s&&(a.$s=b.parent.$s,a.$store=a.$s.$store)}function i(a){a.$options.$computed&&(a.$options.computed=j(a,a.$options.$computed).reduce((a,{key:b,getter:c,setter:d})=>(a[b]=d?{get:c,set:d}:c,a),a.$options.computed||{}))}function j(a,b){if(!b)return[];Array.isArray(b)&&(b=b.reduce((a,b)=>{let c;switch(typeof b){case"string":c=b.replace(/\//g,".").split(".").pop(),a[c]=b;break;case"function":if(c=b.name,!c)throw new Error("computed required function name");a[c]=b;break;case"object":Object.assign(a,b);}return a},{}));let c=[];return Object.keys(b).forEach(d=>{let e=b[d];switch(typeof e){case"string":e=e.replace(/\//g,"."),c.push({key:d,getter(){return n(a.$s,e)},setter(b){return o(a.$s,e,b)}}),"news"==d&&console.log(a.$s,e,d,n(a.$s,e));break;case"function":c.push({key:d,getter:e.bind(a,a.$s)});break;case"object":if(e&&e.get){let b,f=null;switch(typeof e.get){case"string":b=function(){return n(a.$s,e.get)};break;case"function":b=e.get.bind(a,a.$s);break;default:b=()=>e.get;}switch(typeof e.set){case"string":f=b=>o(a.$s,e.set,b);break;case"function":f=function(b){return e.set.call(a,b,a.$s)};}c.push({key:d,getter:b,setter:f})}break;default:c.push({key:d,getter:()=>e});}}),c}function k(a){a.$options.$methods&&(a.$options.methods=l(a,a.$options.$methods).reduce((a,{key:b,func:c})=>(a[b]=c,a),a.$options.methods||{}))}function l(a,b){if(!b)return[];Array.isArray(b)&&(b=b.reduce((a,b)=>{let c;switch(typeof b){case"string":c=b.replace(/\//g,".").split(".").pop(),a[c]=b;break;case"function":if(c=b.name,!c)throw new Error("method required function name");a[c]=b;break;case"object":Object.assign(a,b);}return a},{}));let c=[];return Object.keys(b).forEach(d=>{let e=b[d];switch(typeof e){case"string":e=e.replace(/\//g,"."),c.push({key:d,func:(...b)=>n(a.$s,e).call(a,...b)});break;case"function":c.push({key:d,func:e.bind(a)});break;default:c.push({key:d,getter:()=>e});}}),c}b=b&&b.hasOwnProperty("default")?b["default"]:b,c=c&&c.hasOwnProperty("default")?c["default"]:c;class m{constructor(a,b,c){this.$path=a,this.$store=b,this.$root=c?c:this}get $state(){return this.$path.split(".").reduce((a,b)=>"root"===b?a:a[b],this.$store.state)}get $name(){return this.$path.split(".").pop()}get $_watchVM(){return this.$root.$watchVM?this.$root.$watchVM:(this.$root.$watchVM=new c({store:this.$root}),this.$root.$watchVM)}$registerModule(a,b){this.$store.registerModule(a,b);const c=this.$path+"."+a,d=c.split(".").reduce((a,b)=>{if(a){const c=a[b]||a._children[b];return c?c:void 0}},this.$store._modules);this[a]=new m(this.$path+"."+a,this.$store,this.$root),e(this[a],d,this.$store)}$unregisterModule(a){this.$store.unregisterModule(a),delete this[a]}}const n=(a,b,c,d)=>{if("undefined"==typeof b)return c;for(d=0,b=b.split?b.split("."):b;a&&d<b.length;)a=a[b[d++]];return a===void 0||d<b.length?c:a},o=(a,b,c)=>{let d=b.split(".");if(1===d.length)return a[b]=c;let e=!1;return d.reduce((a,b,f)=>e?c:"object"==typeof a&&a?f===d.length-1?(a[b]=c,e=!0,c):a[b]:void 0,a)};var p=a=>{a.use(b),a.mixin({beforeCreate:function(){const a=this;h(a),i(a),k(a)}})};a.Store=g,a.default={install:p,Store:g},Object.defineProperty(a,"__esModule",{value:!0})});